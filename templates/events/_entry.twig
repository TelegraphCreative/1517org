{% extends "_layouts/base" %} 
{% import '_macros/global' as global %}

{% block content %}

  
    {# Article + Aside (top) #}
    <div class="entry-detail-layout | container | space-b space-menu | flex-grid">

        {# Content #}
        <article class="entry-main | gutter-xl">
        
            {# Header #}
            <header class="entry__header">
                <h1 class="header-xl | font-serif">{{ entry.title }}</h1>
            </header>

            {# Blocks #}
            <div class="entry__blocks | longform-entry-blocks -top">

                {# Example Product Form #}
                {% set purchasableId = craft.app.request.param('purchasableId') %}

                {% if entry.paidEvent|length %}
                    
                    {% set product = craft.products.one() %}
                    <div class="m-10">
                    <a href="/buy/add?purchasableId={{product.defaultVariant.id}}" class="">
                        Buy {{ product.title }} ({{ product.defaultVariant.salePrice|commerceCurrency(cart.currency) }})
                    </a>
                    {% if purchasableId %}
                        purchasableId: {{ purchasableId }}
                        {# if we have a purchasableId as a query param, just add it to cart and submit the form #}
                        <form method="POST" name="auto-add-to-cart" class="add-to-cart-form">
                            <input type="hidden" name="action" value="commerce/cart/update-cart">
                            {{ redirectInput('buy') }}
                            <input type="hidden" name="qty" value="1">
                            {{ csrfInput() }}
                            <input type="hidden" name="purchasableId" value="{{ purchasableId }}">
                            <input type="submit" hidden/>
                        </form>
                        <script>
                            window.onload = function(){
                                document.forms['auto-add-to-cart'].submit();
                            }
                        </script>
 
                    {% endif %}
                {% endif %}
                

            </div>

           
        </article>
        
        
    
    
    </div>


{% endblock %}